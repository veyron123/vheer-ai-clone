# Документация по работе с мокапами

## Обзор функциональности

Система мокапов позволяет пользователям создавать красивые презентации сгенерированных изображений в портретных рамках. Функция доступна только для изображений, созданных с помощью модели GPT Image с определенными соотношениями сторон.

## Архитектура решения

### Основные компоненты

1. **MockupGenerator.jsx** - Главный компонент для создания мокапов
2. **ImageToImageGeneratorPage.jsx** - Интеграция с основным процессом генерации
3. **Рамки (frames)** - PNG изображения с прозрачной областью для контента

### Технологии

- **Canvas API** - для композиции изображений
- **React** - компонентная архитектура
- **Tailwind CSS** - стилизация интерфейса

## Условия активации

Кнопка "Создать мокап" появляется только при выполнении всех условий:

1. ✅ Изображение успешно сгенерировано
2. ✅ Используется модель `gpt-image` (Chat GPT Image)
3. ✅ Выбрано соотношение сторон `1:1` или `4:3`

```javascript
const canShowMockupButton = () => {
  return (
    generatedImage &&
    aiModel === 'gpt-image' &&
    (aspectRatio === '1:1' || aspectRatio === '4:3')
  );
};
```

## Процесс работы

### 1. Генерация изображения
Пользователь генерирует изображение через GPT Image с подходящим соотношением сторон.

### 2. Появление кнопки мокапа
После успешной генерации появляется кнопка "Создать мокап" с градиентным оформлением.

### 3. Открытие редактора
При клике открывается модальное окно с:
- Превью мокапа в реальном времени
- Настройками позиционирования
- Кнопкой скачивания

### 4. Настройка параметров
Пользователь может настроить:
- **Поворот** (-180° до +180°)
- **Масштаб** (50% до 200%)
- **Позиция** (X и Y координаты)

### 5. Экспорт результата
Готовый мокап скачивается в формате PNG с высоким качеством.

## Конфигурация рамок

### Доступные рамки

| Соотношение | Файл | Размер canvas | Область изображения |
|------------|------|---------------|-------------------|
| 1:1 | `/mockups/frame-1x1.png` | 600x600px | 500x500px |
| 4:3 | `/mockups/frame-4x3.png` | 800x600px | 640x480px |

### Структура конфигурации

```javascript
const frameConfig = {
  '1:1': {
    name: 'Square Frame 1:1',
    width: 600,
    height: 600,
    frame: '/mockups/frame-1x1.png',
    screen: { x: 50, y: 50, width: 500, height: 500 }
  },
  '4:3': {
    name: 'Landscape Frame 4:3',
    width: 800,
    height: 600,
    frame: '/mockups/frame-4x3.png',
    screen: { x: 80, y: 60, width: 640, height: 480 }
  }
};
```

## Технические детали

### Canvas API реализация

#### Процесс рендеринга

1. **Загрузка изображения пользователя**
   ```javascript
   const userImg = new Image();
   userImg.crossOrigin = 'anonymous';
   userImg.src = imageUrl;
   ```

2. **Применение области обрезки (clipping)**
   ```javascript
   ctx.beginPath();
   ctx.rect(screen.x, screen.y, screen.width, screen.height);
   ctx.clip();
   ```

3. **Трансформации**
   - Центрирование изображения
   - Применение поворота
   - Масштабирование с автоподгонкой

4. **Композиция с рамкой**
   ```javascript
   const frameImg = new Image();
   frameImg.src = currentFrame.frame;
   ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
   ```

### Автоматическое масштабирование

Система автоматически подгоняет изображение под область рамки:

```javascript
const autoScale = Math.max(
  screen.width / userImg.width,
  screen.height / userImg.height
);
const finalScale = autoScale * scale; // scale - пользовательский множитель
```

### Экспорт изображения

```javascript
const downloadMockup = () => {
  const link = document.createElement('a');
  link.download = `mockup-${aspectRatio}.png`;
  link.href = canvasRef.current.toDataURL();
  link.click();
};
```

## Структура файлов

```
client/
├── public/
│   └── mockups/
│       ├── frame-1x1.png      # Квадратная рамка
│       └── frame-4x3.png      # Горизонтальная рамка
├── src/
│   ├── components/
│   │   └── image-to-image/
│   │       └── MockupGenerator.jsx  # Компонент генератора мокапов
│   └── pages/
│       └── ImageToImageGeneratorPage.jsx  # Интеграция с основной страницей
```

## UI/UX особенности

### Интерфейс редактора

- **Модальное окно** - не блокирует основной контент
- **Реальное время** - мгновенное обновление превью
- **Интуитивные контролы** - слайдеры для всех параметров
- **Кнопка сброса** - быстрый возврат к начальным настройкам

### Визуальная обратная связь

- Индикатор загрузки при обработке
- Плавные переходы при изменении параметров
- Градиентная кнопка для привлечения внимания

## Настройки по умолчанию

- **Масштаб**: 70% (оптимально для большинства изображений)
- **Поворот**: 0°
- **Позиция**: центр (x: 0, y: 0)

## Требования к рамкам

### Формат файлов
- **Формат**: PNG с альфа-каналом
- **Прозрачность**: Центральная область должна быть полностью прозрачной
- **Качество**: Рекомендуется высокое разрешение для четкости

### Создание новых рамок

1. Создайте изображение в графическом редакторе
2. Вырежьте центральную область (сделайте прозрачной)
3. Экспортируйте в PNG с сохранением прозрачности
4. Добавьте конфигурацию в `frameConfig`

## Расширение функциональности

### Добавление новых соотношений сторон

1. Создайте новую рамку в `/public/mockups/`
2. Обновите `frameConfig` в `MockupGenerator.jsx`:
   ```javascript
   '3:4': {
     name: 'Portrait Frame 3:4',
     width: 450,
     height: 600,
     frame: '/mockups/frame-3x4.png',
     screen: { x: 45, y: 60, width: 360, height: 480 }
   }
   ```
3. Добавьте соотношение в условие показа кнопки

### Добавление новых эффектов

Возможные расширения:
- Фильтры изображения (сепия, черно-белое)
- Тени и отражения
- Текстовые подписи
- Водяные знаки

## Оптимизация производительности

### Текущие оптимизации

- **Ленивая загрузка** - компонент загружается только при необходимости
- **Кэширование Canvas** - избегаем лишних перерисовок
- **Оптимальный размер Canvas** - баланс между качеством и производительностью

### Рекомендации

1. Используйте оптимизированные изображения рамок (WebP формат)
2. Ограничивайте максимальный размер canvas для мобильных устройств
3. Добавьте дебаунс для слайдеров при необходимости

## Известные ограничения

1. **CORS политика** - изображения должны быть с того же домена или иметь правильные CORS заголовки
2. **Размер файла** - большие изображения могут замедлить рендеринг
3. **Браузерная совместимость** - требуется поддержка Canvas API

## Troubleshooting

### Проблема: Рамка не загружается
**Решение**: Проверьте путь к файлу и наличие файла в `/public/mockups/`

### Проблема: Изображение не помещается в рамку
**Решение**: Отрегулируйте параметры `screen` в конфигурации рамки

### Проблема: Низкое качество экспорта
**Решение**: Увеличьте параметр `scale` в `canvas.toDataURL()` или используйте `canvas.toBlob()` с высоким качеством

## Тестовые страницы

Для разработки и тестирования доступны отдельные страницы:

- `/mockup-test` - Навигация по всем вариантам
- `/mockup-canvas` - Canvas API реализация
- `/mockup-css` - CSS 3D Transforms версия
- `/mockup-library` - Симуляция библиотечного подхода

## Заключение

Система мокапов предоставляет пользователям мощный инструмент для создания профессиональных презентаций их AI-сгенерированных изображений. Модульная архитектура позволяет легко расширять функциональность и добавлять новые типы рамок.